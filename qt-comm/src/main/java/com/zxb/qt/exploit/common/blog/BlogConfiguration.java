package com.zxb.qt.exploit.common.blog;

import com.zxb.qt.exploit.common.boot.exception.BlogException;
import com.zxb.qt.exploit.common.boot.utils.JsonUtils;
import com.zxb.qt.exploit.common.redis.RedisKeys;
import com.zxb.qt.exploit.common.redis.RedisUtils;
import com.zxb.qt.exploit.entity.vo.BlogBasicTagVO;
import com.zxb.qt.exploit.mapper.BlogBasicsTagVoMapper;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.annotation.Bean;
import org.springframework.stereotype.Component;


// @Component
public class BlogConfiguration {

    @Autowired
    private BlogBasicsTagVoMapper blogBasicsTagVoMapper;

    @Autowired
    private RedisUtils redisUtils;


    //private BlogBasics topBlogBasics;


    private void cacheTopBlog(){
        // 获取我滴 博客置顶
        BlogBasicTagVO blogBasicTagVO = blogBasicsTagVoMapper.queryBasicTagTopOne();
        if ( blogBasicTagVO == null ){
            return ;
        }
        String json = JsonUtils.obj2String( blogBasicTagVO );
        redisUtils.set( new RedisKeys( "blog","top","0" ).buildKeys(), json );
    }



    @Bean
    public void init(){
        try {
            cacheTopBlog();
        } catch (Exception e) {
            //throw new BlogException( "-1" , " 数据库链接失败? ,博客存在多个先同置顶 ? " );
            e.printStackTrace();
        }
    }





}
