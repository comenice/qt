package com.zxb.qt.exploit.common.boot.listener;

import com.zxb.qt.exploit.common.redis.RedisKeys;
import com.zxb.qt.exploit.common.redis.RedisUtils;
import com.zxb.qt.exploit.entity.BlogTag;
import com.zxb.qt.exploit.entity.vo.BlogBasicPropVO;
import com.zxb.qt.exploit.mapper.BlogTagMapper;
import org.springframework.beans.factory.annotation.Autowired;

import javax.servlet.ServletContextEvent;
import javax.servlet.ServletContextListener;
import javax.servlet.annotation.WebListener;
import java.util.List;
import java.util.Map;
import java.util.stream.Collectors;


@WebListener
public class WebContextListener implements ServletContextListener {

    private  final static String tagMap = new RedisKeys("blog","tag","map").buildKeys();

    @Autowired
    private RedisUtils redisUtils;

    @Autowired
    private BlogTagMapper blogTagMapper;

    @Override
    public void contextInitialized(ServletContextEvent sce) {
//        //已过期 不存在
//        //缓存所有 标签
//        Map map = null;
//        if ( !redisUtils.hasKey( tagMap ) ){
//            List<BlogTag> list = blogTagMapper.selectList( null );
//            map = list.stream().collect(Collectors.toMap( BlogTag::getId , a -> a,(k1, k2)->k1)   );
//            redisUtils.hmset( tagMap , map );
//        }
//        System.out.println( "标签 初始化" );
    }

    @Override
    public void contextDestroyed(ServletContextEvent sce) {

    }
}
